export default async function handler(req, res) {
  try {
    const { identifier, page = 1, perPage = 50 } = req.query;

    // Use either secret; keep it on the server only
    const apiKey =
      process.env.CROSSMINT_CLIENT_SECRET || process.env.CROSSMINT_API_KEY;

    if (!apiKey) {
      return res
        .status(500)
        .json({ error: "Server missing CROSSMINT_CLIENT_SECRET or CROSSMINT_API_KEY" });
    }
    if (!identifier) {
      return res
        .status(400)
        .json({ error: "Missing wallet identifier (e.g. solana:YourWalletAddress)" });
    }

    const url = new URL(
      `https://www.crossmint.com/api/2022-06-09/wallets/${identifier}/nfts`
    );
    url.searchParams.set("page", page);
    url.searchParams.set("perPage", perPage);

    const r = await fetch(url, { headers: { "X-API-KEY": apiKey } });
    const text = await r.text();
    res.status(r.status).send(text);
  } catch (e) {
    res.status(500).json({ error: e.message || "Proxy error" });
  }
}
